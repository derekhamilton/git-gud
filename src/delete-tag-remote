#!/bin/bash

delete-tag-remote () {
    tags=$(git --no-pager tag | awk '{print "\x1b[35;1mtag\x1b[m\t" $1}' | tac) || exit
    tag=$(echo "$tags" | fzf --ansi --preview='echo "Select a tag. No action is taken until selecting a remote."' --preview-window down:5)

    if [ -z "$tag" ]; then
        exit
    fi

    remotes=$(git remote -v | uniq)
    target=$(echo "$remotes" | grep push | fzf --preview="echo \"git tag -d $tag && git push {1} \":refs/tags/$tag\"\"" --preview-window down:5)

    if [ -z "$target" ]; then
        exit
    fi

    remote=$(echo "$target" | awk '{print $1}')
    run-command "git tag -d $tag"
    run-command "git push $remote :refs/tags/$tag"
}
